# ExpanderX

- 此程序是一个聊天应用 PC 客户端`(目前只支持钉钉)`的功能扩展工具，通过自定义不同的规则实现不同的扩展功能，例如针对特定关键词进行自动回复等。
- 此程序不对聊天应用本身做任何更改，此程序本身也无需网络，仅在本地以 Windows 提供的 UI 自动化工具 UIAutomation 进行聊天消息等内容的获取以及自动输入等操作。

<br/>

# 目录

- [功能逻辑](#功能逻辑)
- [初级教程](#初级教程)
- [赞赏](#赞赏)

<br/>

# 功能逻辑

此程序以"规则"来实现聊天工具的功能扩展，而"规则"则是由若干个"任务模块"组成的。也就是说，用户可以选择不同的"任务模块"组合成不同的规则。而"任务模块"又可以由用户选择具体设置，所以就算是相同任务模块组成的规则，其功能也可能是不一样的。<br/><br/>
"任务模块"可分为有"匹配"功能的任务模块(匹配器)，或是有"执行"功能的任务模块(执行器)，又或者是集两个功能于一身的任务模块(既是匹配器也是执行器)。<br/><br/>
将若干任务模块组合成规则时，待合并的任务模块中至少要包含一个"匹配器"和一个"执行器"，否则不能组合成规则。规则中有"匹配"功能的任务模块负责匹配任务条件，有"执行"功能的任务模块负责执行一些操作。<br/><br/>
点击"开启服务"按钮后程序以周期循环的方式，遍历并执行所有已启用的规则，直到点击"停止服务"按钮。对规则的执行逻辑是：

1. 按合成规则时设定的"匹配器"的顺序逐个匹配器进行任务条件匹配，如果所有匹配器都已匹配，则按顺序逐个"执行器"执行其操作。
2. 如果规则中有一个"匹配器"不匹配，则不再检查剩余的匹配器，不再执行规则中任何"执行器"，跳出此条规则立即开始执行下一条规则。

<br/>

# 初级教程

## 简单例子

### 1. 例子一：自动回复包含关键词的消息





## 使用流程

- [支持的系统版本和钉钉版本](#支持的系统版本和钉钉版本)
- [程序的下载安装和卸载](#程序的下载安装和卸载)
- [启动此程序和钉钉](#启动此程序和钉钉)
- [任务模块设置中的各种名词图解](#任务模块设置中的各种名词图解)
- [选择任务模块并组合为规则](#选择任务模块并组合为规则)
- [启用想用的规则并开启服务](#启用规则并开启服务)
- [部分设置项的功能解释和用法](#部分设置项的功能解释)
- [一些已知的和可能出现的问题](#一些已知的和可能出现的问题)

## 支持的系统版本和钉钉版本

- 对操作系统要求：
  + 此程序需要 .NET Framework 4.6.2 或更新版本的支持，所以要求操作系统版本为 Windows10（Windows 10 自带 .NET Framework 4.8 ），其他版本的 Windows 请自行测试。
- 对钉钉版本要求：
  + 已知支持的钉钉PC客户端版本是 6.5.1 ~ 6.5.10，其他版本未测试。

## 程序的下载安装和卸载

- 安装

   + 请到此程序版本发布页下载最新版：
[GitHub](https://github.com/hrpzcf/ExpanderX/releases) 或 [Gitee](https://gitee.com/hrpzcf/ExpanderX/releases)，下载名为`ExpanderX_x.x.x.xxxxxx_Windows10.msi`的安装包文件，下载完成后双击运行安装程序，一路“下一步”即可完成安装。安装完成后系统桌面和开始菜单都会新增 ExpanderX 的快捷方式。

- 卸载
   + 打开系统开始菜单，找到ExpanderX快捷方式，右击选择“卸载”，转到“程序和功能”面板，找到“ExpanderX”，右击选择“卸载”，稍等即可卸载。
   + 卸载程序后，保存的配置文件、规则文件等不会被删除，如果你想删除，请找到以下路径手动将整个“ExpanderX”文件夹删除：C:\Users\\{你的用户名}\AppData\Local\ExpanderX。

## 启动此程序和钉钉

双击 ExpanderX 桌面快捷方式或从系统开始菜单点击 ExpanderX 快捷方式启动此程序。双击钉钉桌面图标启动钉钉并打开任一消息框。

## 任务模块设置中的各种名词图解

![名词图解](/Images/diagram.png)

## 选择任务模块并组合为规则

1. 切换到“规则添加及删除”标签页。
2. 点击“已配置待合并的任务模块”下方“添加”按钮。
3. 在弹出的窗口左侧选择合适的任务模块。
4. 填写“新的配置备注名”。
5. 勾选备注名下方的“使用匹配功能”或“使用执行功能”。
6. 在下方的“任务模块配置区”选择具体配置。
7. 点击窗口右下角的“添加配置”。
8. 重复步骤 2 ~ 7，直到所需功能添加完成。
9. 点击下方“任务模块组合为规则”按钮完成规则的添加。

## 启用规则并开启服务

1. 切换到“规则启停及描述”标签页。
2. 勾选“全部已创建的规则”中想要的规则。
3. 点击左侧“开启服务”按钮，规则生效。
4. 如果开启服务后又新增了规则，则需要先点击“停止服务”，勾选新增的规则，再开启服务，新增的规则才能生效。
5. 开启服务时钉钉不能关闭钉钉主窗口，开启服务后可以把钉钉最小化到系统托盘，但不要退出钉钉。

<br/>

# 部分设置项的功能解释

- ### 服务运行周期随机间隔
  + 程序遍历所有规则前的停顿时间，该时间每个周期都从设置的时间范围内随机生成，单位为“秒”。如果没有特殊需求，则此时间不宜设置得过小，否则此程序和钉钉的CPU占用率都会明显增加。
- ### 开启服务时检查聊天客户端是否就绪
  + 点击“开启服务”按钮时是否检查钉钉是否已经运行就绪(包括是否已打开任意消息框)。如果勾选此设置，则钉钉未就绪时无法开启服务。如果未勾选，钉钉未就绪时可以开启服务，但是使用到钉钉的任务模块不会有效果。
- ### 关闭窗口时
  + 如果选择“退出程序”，则关闭此程序主窗口后此程序服务自动停止服务并完全退出。如果选择“最小化到托盘”，则关闭此程序主窗口后程序不会退出，而是收到系统托盘区，可以双击系统托盘区的ExpanderX图标重新打开此程序的主窗口，也可以右键系统托盘区的ExpanderX图标选择相应操作菜单。
- ### 程序退出时有未合并的任务模块
  + 当选择了任务模块但忘记合并为规则时，此选项指示相应的操作。如果选择“合并并退出”，则此程序退出时自动以固定名称命名规则并保存。

<br/>

# 一些已知的和可能出现的问题

1. ### 开启服务时主窗口长时间无响应
   + 钉钉未完全就绪时开启服务可能会出现此问题，建议钉钉完全就绪后再开启服务。如果出现无响应的情况，请直接强行关闭此程序。
2. ### 运行此程序时出现“已经有一个 ExpanderX 实例正在运行！”提示
   + 此提示说明此程序（ExpanderX）已经在运行了，检查系统托盘区域有没有 ExpanderX 图标，包括系统托盘折叠区域。

<br/>

# TODO

- [x] 聊天消息关键词匹配器
- [ ] 时间、日期匹配器
- [x] 自动回复消息执行器
- [x] 控制ExpanderX启停执行器
- [x] 命令行程序执行器
- [x] 消息弹窗提醒执行器
- [ ] 消息写入Excel执行器
- [ ] 其他(插件、匹配器、执行器)...

<br/>

# 赞赏

如果你觉得这个程序对你有帮助，请支持我继续更新！

* 微信

![weichat](Images/wechat.png)
